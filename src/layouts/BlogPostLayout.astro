---
import Layout from "./Layout.astro";
import NavBar from "@/components/header/NavBar.astro";
import HeaderMenu from "@/components/header/HeaderMenu.astro";
import MobileMenu from "@/components/header/MobileMenu.astro";
import Footer from "@/components/footer/Footer.astro";
import TagRow from "@/components/shared/atoms/TagRow.astro";
import Tag from "@/components/shared/atoms/Tag.astro";
import BackLink from "@/components/shared/atoms/BackLink.astro";
import Prose from "@/components/articles/Prose.astro";

interface Props {
  title: string;
  description: string;
  date: Date;
  tags: string[];
}

const { title, description, date, tags } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const formattedDate = date.toLocaleDateString("fr-FR", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

const blogPostingJsonLd = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: title,
  description,
  datePublished: date.toISOString(),
  author: {
    "@type": "Person",
    name: "Martin Kinoo",
    url: "https://kinoo.dev",
  },
  url: canonicalURL.href,
};
---

<Layout title={`${title} Â· Martin Kinoo`} description={description} ogType="article" jsonLd={blogPostingJsonLd}>
  <NavBar slot="header-nav" items={[{ label: "Articles", href: "/articles", color: "#f8ba88" }]} />
  <HeaderMenu slot="header-menu" />
  <MobileMenu slot="header-menu" />

  <Fragment slot="head">
    <meta property="article:published_time" content={date.toISOString()} />
    {tags.map((tag) => <meta property="article:tag" content={tag} />)}
  </Fragment>

  <main>
    <article>
      <header class="article-header">
        <BackLink href="/articles" text="Articles" />
        <h1>{title}</h1>
        <time datetime={date.toISOString()}>{formattedDate}</time>
        {tags.length > 0 && (
          <TagRow class="article-tags">
            {tags.map((tag) => <Tag title={tag} />)}
          </TagRow>
        )}
      </header>
      <Prose>
        <slot />
      </Prose>
    </article>
    <Footer />
  </main>
</Layout>

<style>
  main {
    margin: auto;
    padding: 1rem 32px;
    max-width: 1368px;
  }

  article {
    max-width: 720px;
    margin: 0 auto;
    padding-top: 48px;
    padding-bottom: 64px;
  }

  .article-header {
    margin-bottom: 48px;
  }

  .article-header :global(.link) {
    margin-bottom: 24px;
    text-decoration: none;
  }

  h1 {
    font-size: var(--h2-size);
    font-weight: 300;
    line-height: 1;
    color: var(--light-color);
    margin-bottom: 12px;
    text-wrap: balance;
  }

  time {
    font-size: 14px;
    color: var(--text-muted);
  }

  .article-tags {
    margin-top: 16px;
    padding-top: 0;
  }

  @media screen and (max-width: 900px) {
    main {
      padding: 1rem 16px;
    }
  }
</style>
