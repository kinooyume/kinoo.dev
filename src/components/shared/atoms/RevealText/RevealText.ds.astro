---
import RevealTextComponent from "./RevealText.astro";
import DSBlock from "@/components/design-system/DSBlock.astro";
import DSPreview from "@/components/design-system/DSPreview.astro";
import DSCode from "@/components/design-system/DSCode.astro";
import DSPropsTable from "@/components/design-system/DSPropsTable.astro";
import DSSectionHeader from "@/components/design-system/DSSectionHeader.astro";
---

<section id="revealtext">
  <DSSectionHeader title="RevealText" atomic="Atom" framework="astro" />
  <p>Composable text reveal that self-animates when its trigger event fires.</p>

  <DSBlock title="Wave (default)">
    <DSPreview>
      <div id="ds-wave-demo">
        <RevealTextComponent text="Expériences" as="span" trigger="ds-wave" />
      </div>
      <button class="ds-play-btn" data-ds-trigger="ds-wave">Play</button>
    </DSPreview>
    <DSCode inline>&lt;RevealText text="Expériences" trigger="my-event" /&gt;</DSCode>
  </DSBlock>

  <DSBlock title="Slide">
    <DSPreview>
      <div id="ds-slide-demo">
        <RevealTextComponent text="Mes projets" as="h2" animation="slide" trigger="ds-slide" />
      </div>
      <button class="ds-play-btn" data-ds-trigger="ds-slide">Play</button>
    </DSPreview>
    <DSCode inline>&lt;RevealText text="Mes projets" as="h2" animation="slide" trigger="my-event" /&gt;</DSCode>
  </DSBlock>

  <DSBlock title="Props">
    <DSPropsTable
      headers={["Prop", "Type", "Default", "Description"]}
      rows={[
        [{ code: "text" }, "string", "required", "Text content to reveal"],
        [{ code: "as" }, "string", '"span"', "HTML tag to render"],
        [{ code: "animation" }, '"wave" | "slide"', '"wave"', "Animation variant"],
        [{ code: "trigger" }, "string", "-", "Event name that starts the animation"],
        [{ code: "class" }, "string", "-", "CSS class forwarded to the root element"],
      ]}
    />
  </DSBlock>
</section>

<script>
  import { animate, stagger } from "animejs";

  document.querySelectorAll<HTMLButtonElement>(".ds-play-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const container = btn.closest("[class*='preview']") ?? btn.parentElement;
      if (!container) return;

      const waves = container.querySelectorAll<HTMLElement>("[data-reveal-text='wave']");
      waves.forEach((el) => {
        const letters = el.querySelectorAll(".reveal-letter");
        if (!letters.length) return;
        animate(letters, {
          translateY: ["1.1em", 0],
          duration: 750,
          delay: stagger(30, { start: 200 }),
          ease: "outElastic(1, .5)",
        });
      });

      const slides = container.querySelectorAll<HTMLElement>("[data-reveal-text='slide']");
      slides.forEach((el) => {
        animate(el, {
          opacity: [0, 1],
          translateX: [30, 0],
          duration: 600,
          delay: 250,
          ease: "outElastic(1, .5)",
        });
      });
    });
  });
</script>

<style>
  .ds-play-btn {
    margin-top: 12px;
    padding: 6px 16px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: var(--card-surface);
    color: var(--light-color);
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .ds-play-btn:hover {
    background: var(--card-surface-hover);
    border-color: var(--border-hover-color);
  }
</style>
