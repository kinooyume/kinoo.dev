---
import CardComponent from "./Card.astro";
import CardContent from "./CardContent.astro";
import CardTitle from "./CardTitle.astro";
import Spotlight from "@/components/shared/molecules/Spotlight.astro";
import Tag from "@/components/shared/atoms/Tag.astro";
import DSBlock from "@/components/design-system/DSBlock.astro";
import DSPreview from "@/components/design-system/DSPreview.astro";
import DSCode from "@/components/design-system/DSCode.astro";
import DSPropsTable from "@/components/design-system/DSPropsTable.astro";
import DSNote from "@/components/design-system/DSNote.astro";
import DSStructure from "@/components/design-system/DSStructure.astro";
import DSSectionHeader from "@/components/design-system/DSSectionHeader.astro";
---

<!-- CARD -->
<section id="card">
  <DSSectionHeader title="Card" atomic="Molecule" framework="astro" />
  <p>Base container with gradient border.</p>

  <DSBlock title="Basic Card">
    <DSPreview class="preview-card">
      <CardComponent>
        <p>Card content goes here. Cards use slots for flexible content.</p>
      </CardComponent>
    </DSPreview>
    <DSCode inline>&lt;Card&gt;...content...&lt;/Card&gt;</DSCode>
  </DSBlock>

  <DSBlock title="Card with Content">
    <DSPreview class="preview-card">
      <CardComponent>
        <div class="card-content-demo">
          <div class="title-row">
            <h3>Project Title</h3>
            <Tag title="React" />
          </div>
          <p class="description">Description du projet avec des tags et un titre.</p>
          <div class="tags">
            <Tag title="TypeScript" />
            <Tag title="Next.js" />
          </div>
        </div>
      </CardComponent>
    </DSPreview>
  </DSBlock>

  <DSBlock title="Card Family Overview">
    <DSPropsTable
      headers={["Component", "Purpose", "Usage"]}
      rows={[
        [{ code: "Card" }, "Base container", "Wrapper with gradient border"],
        [{ code: "CardContent" }, "Layout helper", "Title + logo + body (experiences, formations)"],
        [{ code: "CardTitle" }, "Title block", "Job/project title with metadata"],
        [{ code: "CardSplit" }, "Grid layout", "Title + description + aside (realisations)"],
        [{ code: "CardDescription" }, "Text wrapper", "Paragraph gap, hides <br>, flex:1"],
      ]}
    />
  </DSBlock>

</section>

<!-- CARD CONTENT -->
<section id="card-content">
  <DSSectionHeader title="CardContent" atomic="Molecule" framework="astro" />
  <p>Layout with named slots, used inside Card.</p>

  <DSBlock title="Slots">
    <DSStructure
      rows={[
        { code: "slot=\"title\"", description: "Header/title area (CardTitle)" },
        { code: "slot=\"marge\"", description: "Right-aligned content next to title (LogoBox)" },
        { code: "default slot", description: "Body: CardDescription + TagRow" },
      ]}
    />
  </DSBlock>

  <DSBlock title="Usage">
    <DSCode inline>&lt;Card&gt;&lt;CardContent&gt;&lt;CardTitle slot="title" /&gt;&lt;LogoBox slot="marge" /&gt;&lt;CardDescription&gt;...&lt;/CardDescription&gt;&lt;TagRow&gt;...&lt;/TagRow&gt;&lt;/CardContent&gt;&lt;/Card&gt;</DSCode>
  </DSBlock>

  <DSBlock title="Responsive spacing">
    <DSPropsTable
      headers={["Element", "Desktop", "≤900px", "≤600px"]}
      rows={[
        ["Title → body gap", "24px", "18px", "14px"],
      ]}
    />
  </DSBlock>
</section>

<!-- CARD TITLE -->
<section id="card-title">
  <DSSectionHeader title="CardTitle" atomic="Molecule" framework="astro" />
  <p>Title block for cards with company/project metadata. Uses H3Tagged internally.</p>

  <DSBlock title="Props">
    <DSPropsTable
      headers={["Prop", "Type", "Description"]}
      rows={[
        [{ code: "title" }, "string", "Main title (uses H3Tagged)"],
        [{ code: "tag" }, "string", "Category badge"],
        [{ code: "href" }, "string", "Company/project URL"],
        [{ code: "label" }, "string", "Link text"],
        [{ code: "location" }, "string", "Location (with dot separators)"],
        [{ code: "date" }, "string", "Date range"],
      ]}
    />
  </DSBlock>

  <DSBlock title="Usage">
    <DSCode inline>&lt;CardTitle slot="title" title="Developer" tag="Freelance" ... /&gt;</DSCode>
  </DSBlock>
</section>

<!-- CARD DESCRIPTION -->
<section id="card-description">
  <DSSectionHeader title="CardDescription" atomic="Molecule" framework="astro" />
  <p>Text wrapper for card content. Handles paragraph gap and hides <code>&lt;br&gt;</code>.</p>

  <DSBlock title="Features">
    <DSStructure
      rows={[
        { code: "gap: 12px → 10px", description: "Paragraph spacing (responsive at ≤600px)" },
        { code: "flex: 1", description: "Fills remaining card height" },
        { code: "br { display: none }", description: "Gap replaces line breaks" },
      ]}
    />
  </DSBlock>

  <DSBlock title="Usage">
    <DSCode inline>&lt;CardDescription&gt;&lt;p&gt;...&lt;/p&gt;&lt;ul&gt;...&lt;/ul&gt;&lt;/CardDescription&gt;</DSCode>
    <DSNote>Used inside CardContent (default slot) and CardSplit (description slot).</DSNote>
  </DSBlock>
</section>

<!-- CARD SPLIT -->
<section id="card-split">
  <DSSectionHeader title="CardSplit" atomic="Molecule" framework="astro" />
  <p>Two-column grid layout for cards with title, description, and aside areas.</p>

  <DSBlock title="Layout Preview">
    <DSPreview class="preview-card">
      <div class="card-split-demo">
        <div class="split-title">
          <div class="placeholder-box">Title Slot</div>
        </div>
        <div class="split-description">
          <div class="placeholder-box tall">Description Slot</div>
        </div>
        <div class="split-aside">
          <div class="placeholder-box full">Aside Slot</div>
        </div>
      </div>
    </DSPreview>
    <DSCode inline>&lt;CardSplit reverse&gt; to flip layout</DSCode>
  </DSBlock>

  <DSBlock title="Props">
    <DSPropsTable
      headers={["Prop", "Type", "Default", "Description"]}
      rows={[
        [{ code: "reverse" }, "boolean", "false", "Flips the layout (aside on left)"],
        [{ code: "vertical" }, "boolean", "false", "Single-column: title → aside → description"],
      ]}
    />
  </DSBlock>

  <DSBlock title="Responsive spacing">
    <DSPropsTable
      headers={["Element", "Desktop", "≤1100px", "≤600px"]}
      rows={[
        ["Row gap", "24px", "18px", "14px"],
        ["Column gap", "64px", "—", "—"],
      ]}
    />
  </DSBlock>

  <DSBlock title="Slots">
    <DSPropsTable
      headers={["Slot", "Grid Area", "Description"]}
      rows={[
        [{ code: "title" }, "Top-left", "Card header with H3Tagged"],
        [{ code: "description" }, "Bottom-left", "Main content area"],
        [{ code: "aside" }, "Right column (spans 2 rows)", "Image, slider, etc."],
      ]}
    />
  </DSBlock>
</section>

<!-- EXPERIENCE CARD -->
<section id="experience-card">
  <DSSectionHeader title="Experience Card" atomic="Template" framework="astro" />
  <p>Composed card pattern used in the Experiences section: Spotlight + Card + CardContent + CardTitle.</p>

  <DSBlock title="Preview">
    <DSPreview class="preview-card" id="experience-card-spotlight" data-spotlight>
      <Spotlight color="var(--pink)">
        <CardComponent>
          <CardContent>
            <CardTitle
              slot="title"
              title="Lead Developer"
              tag="Freelance"
              href="https://example.com"
              label="Company"
              location="Lille"
              date="2024"
            />
            <p slot="description">
              Description of the role and responsibilities. Includes <strong>highlighted</strong> technologies and achievements.
            </p>
            <ul>
              <li>Feature or responsibility one</li>
              <li>Feature or responsibility two</li>
            </ul>
            <div slot="marge" class="logo-placeholder">Logo</div>
          </CardContent>
        </CardComponent>
      </Spotlight>
    </DSPreview>
  </DSBlock>
</section>

<script>
  import { spotlight } from "@/lib/dom/spotlight";

  const container = document.getElementById("experience-card-spotlight");
  if (container) {
    spotlight(container);
  }
</script>

<style>
  .card-content-demo {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .card-content-demo .title-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .card-content-demo h3 {
    margin: 0;
    font-size: 24px;
  }
  .card-content-demo .description {
    color: var(--light-color);
    font-weight: 200;
  }
  .card-content-demo .tags {
    display: flex;
    gap: 8px;
  }
  .card-content-demo .tags :global(.tag) {
    opacity: 1;
  }
  .card-split-demo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: 16px;
    width: 100%;
  }
  .split-title {
    grid-area: 1 / 1 / 2 / 2;
  }
  .split-description {
    grid-area: 2 / 1 / 3 / 2;
  }
  .split-aside {
    grid-area: 1 / 2 / 3 / 3;
  }
  .placeholder-box {
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px dashed rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
    font-size: 13px;
    color: var(--color);
    opacity: 0.6;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .placeholder-box.tall {
    height: 100px;
  }
  .placeholder-box.full {
    height: 100%;
    min-height: 176px;
  }
  .logo-placeholder {
    width: 51px;
    height: 51px;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px dashed rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: var(--color);
    opacity: 0.6;
  }
  :global(#experience-card-spotlight .ds-preview) ul {
    list-style: initial;
    margin-left: 24px;
    margin-top: 12px;
  }
  :global(#experience-card-spotlight .ds-preview) ul li {
    color: var(--light-color);
    font-weight: 200;
  }
</style>
