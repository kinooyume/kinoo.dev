---
import DSBlock from "@/components/design-system/DSBlock.astro";
import DSPreview from "@/components/design-system/DSPreview.astro";
import DSSectionHeader from "@/components/design-system/DSSectionHeader.astro";
---

<section id="navbar">
  <DSSectionHeader title="NavBar" atomic="Molecule" framework="astro" />
  <p>
    Horizontal navigation bar with scroll-based active indicator and color-coded
    links for each section.
  </p>

  <DSBlock title="Interactive Demo">
    <DSPreview>
      <nav class="navbar-interactive" id="navbar-demo">
        <ul>
          <li>
            <a href="#" data-color="#f68dab" class="nav active">Expériences</a>
          </li>
          <li><a href="#" data-color="#66c384" class="nav">Réalisations</a></li>
          <li><a href="#" data-color="#9c85d3" class="nav">Formations</a></li>
        </ul>
        <div class="indicator"></div>
      </nav>
    </DSPreview>
  </DSBlock>

</section>

<script>
  // Interactive navbar demo
  const navbar = document.getElementById("navbar-demo");
  if (navbar) {
    const navbarEl = navbar;
    const links = navbarEl.querySelectorAll("a");
    const indicator = navbarEl.querySelector(".indicator") as HTMLElement;
    let activeLink: Element | null = navbarEl.querySelector("a.active");

    function updateIndicator(link: Element) {
      const rect = link.getBoundingClientRect();
      const parentRect = navbarEl.getBoundingClientRect();
      indicator.style.left = `${rect.left - parentRect.left}px`;
      indicator.style.width = `${rect.width}px`;
      indicator.style.backgroundColor =
        (link as HTMLElement).dataset.color || "var(--accent-color)";
    }

    // Initialize
    if (activeLink) {
      const link = activeLink;
      requestAnimationFrame(() => updateIndicator(link));
    }

    links.forEach((link) => {
      link.addEventListener("mouseenter", () => updateIndicator(link));

      link.addEventListener("click", (e) => {
        e.preventDefault();
        links.forEach((l) => l.classList.remove("active"));
        link.classList.add("active");
        activeLink = link;
        updateIndicator(link);
      });
    });

    navbar.addEventListener("mouseleave", () => {
      if (activeLink) updateIndicator(activeLink);
    });
  }
</script>

<style>
  .navbar-interactive {
    position: relative;
    display: flex;
    align-items: center;
  }
  .navbar-interactive ul {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    margin: 0;
  }
  .navbar-interactive li {
    list-style: none;
  }
  .navbar-interactive a {
    display: block;
    padding: 16px 16px;
    font-size: 18px;
    font-weight: 200;
    color: var(--color);
    text-decoration: none;
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }
  .navbar-interactive a:hover,
  .navbar-interactive a.active {
    opacity: 1;
  }
  .navbar-interactive .indicator {
    position: absolute;
    bottom: 0;
    height: 2px;
    border-radius: 1px;
    transition: all 0.3s ease;
    background-color: var(--accent-color);
  }
</style>
