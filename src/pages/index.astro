---
import Layout from "@/layouts/Layout.astro";
import Hero from "@/components/Hero.astro";
import Experiences from "@/components/Experiences.astro";
import Contact from "@/components/Contact.astro";
import Formations from "@/components/Formations.astro";
import Realisations from "@/components/Realisations.astro";
import FloatingContact from "@/components/FloatingContact.astro";
---

<Layout title="Martin Kinoo · Développeur Front-end freelance">
  <script>
    import anime from "animejs/lib/anime.es.js";

    const nav = performance.getEntriesByType("navigation")[0];
    if (
      (nav && window.scrollY !== 0) ||
      (performance.navigation &&
        performance.navigation.type === 2 &&
        window.scrollY !== 0)
    ) {
      window.scrollTo({ top: 0, behavior: "auto" });
    }
    // SECTiONS
    // Configuration de l'Intersection Observer
    const observerOptions = {
      threshold: 0.1,
      rootMargin: "0px 0px -100px 0px",
    };

    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const section = entry.target as HTMLElement;

          // Animation des cartes dans les sections
          // const cards = section.querySelectorAll("[data-animate-card]");
          //
          // if (cards.length > 0) {
          //   anime({
          //     targets: cards,
          //     opacity: [0, 1],
          //     translateY: [30, 0],
          //     scale: [0.95, 1],
          //     duration: 800,
          //     delay: anime.stagger(200), // 200ms entre chaque carte
          //     easing: "easeOutExpo",
          //     begin: () => {
          //       section.style.opacity = "1"; // Assurer que la section est visible
          //     },
          //   });
          // } else {
          //   // Animation simple pour les sections sans cartes
          anime({
            targets: section,
            opacity: [0, 1],
            translateY: [20, 0],
            duration: 600,
          });
          // }

          sectionObserver.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Observer les sections
    function initAnimations() {
      // Ne pas initialiser les animations si l'animation Hero n'est pas terminée
      if (!window.heroAnimationCompleted) {
        return;
      }

      const sectionsToAnimate = document.querySelectorAll(
        "[data-animate-section]:not(#hero)",
      );
      sectionsToAnimate.forEach((section) => {
        // État initial
        (section as HTMLElement).style.opacity = "0";
        sectionObserver.observe(section);
      });
    }

    // Initialiser après que l'animation Hero soit terminée
    window.addEventListener("heroAnimationComplete", initAnimations);

    // Initialiser au chargement si l'animation Hero est déjà terminée
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(initAnimations, 100); // Petit délai pour laisser heroAnime.ts s'initialiser
    });

    document.addEventListener("astro:page-load", initAnimations);

    // CARDS

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const card = entry.target;

          // Animation stylée pour les cartes

          // anime({
          //   targets: Array.from(card.children),
          //   opacity: [0, 1],
          //   translateY: [30, 0],
          //   duration: 500,
          //   easing: "easeOutCubic",
          //   delay: anime.stagger(120),
          // });

          const divs = card.querySelectorAll("[data-animate-elem]");
          anime
            .timeline()
            .add({
              targets: card,
              opacity: [0, 1],
              translateY: [50, 0],
              scale: [0.8, 1],
              duration: 600,
              delay: (el, i) => i * 200,
            })
            // .add({
            //   targets: card.querySelectorAll(".title"),
            //   opacity: [0, 1],
            //   translateX: [-20, 0],
            //   duration: 600,
            //   easing: "easeOutQuad",
            //   delay: anime.stagger(100), // Animation en cascade
            // })
            .add({
              targets: divs,
              opacity: [0, 1],
              translateX: [-20, 0],
              duration: 800,
              delay: anime.stagger(200), // Animation en cascade
            });
          // .add({
          //   targets: card.querySelectorAll(".text"),
          //   opacity: [0, 1],
          //   translateX: [-20, 0],
          //   duration: 600,
          //   easing: "easeOutQuad",
          //   delay: anime.stagger(100), // Animation en cascade
          // });

          observer.unobserve(card); // Arrêter d'observer une fois animée
        }
      });
    }, observerOptions);

    // Observer les cartes
    function initCardAnimations() {
      const cardsToAnimate = document.querySelectorAll("[data-animate-card]");
      cardsToAnimate.forEach((card) => {
        (card as HTMLElement).style.opacity = "0"; // État initial
        (card as HTMLElement).style.transform = "translateY(50px) scale(0.8)";
        observer.observe(card);
      });
    }

    // Initialiser après que l'animation Hero soit terminée
    window.addEventListener("heroAnimationComplete", initCardAnimations);

    // Initialiser au chargement si l'animation Hero est déjà terminée
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(initCardAnimations, 100); // Petit délai pour laisser heroAnime.ts s'initialiser
    });
  </script>
  <main>
    <Hero />
    <!-- <HeroInfo /> -->
    <Experiences />
    <Realisations />
    <!-- <Appetences /> -->
    <Formations />
    <!-- <Passions /> -->
    <Contact />
    <footer>
      <p>
        © 2024 · Design et Code par <b>Martin Kinoo</b> · Réalisé avec <a
          href="https://figma.com">Figma</a
        > et <a href="https://astro.build">Astro</a>.
      </p>
    </footer>
    <FloatingContact />
  </main>
</Layout>

<style>
  [data-animate-card] > * {
    opacity: 0;
    transform: translateY(30px);
  }
  footer {
    opacity: 0.8;
  }
  footer a {
    text-decoration: underline;
  }
  main {
    margin: auto;
    padding: 1rem 32px;
    max-width: 1368px;
    line-height: 1.6;
  }
  footer p {
    font-size: 15px;
    display: block;
    margin: 36px 0;
  }

  @media screen and (max-width: 900px) {
    main {
      padding: 1rem 16px;
    }
  }
</style>
